name: PR Verify

on:
  pull_request:
    branches:
      - main
    types: [opened, synchronize, reopened, ready_for_review, labeled, unlabeled]

permissions: {}

jobs:
  bicep-validation:
    permissions:
      contents: read
    if: github.event.pull_request.draft == false
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Azure CLI
      uses: azure/login@v2
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    
    - name: Validate Bicep modules
      shell: bash
      run: |
        echo "Validating Bicep modules..."
        for bicep_file in $(find modules -name "main.bicep"); do
          echo "Validating $bicep_file"
          az bicep build --file "$bicep_file"
        done
